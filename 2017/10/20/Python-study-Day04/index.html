<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Python-study-Day04 | 自恋的爱</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/component.css" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <meta name="generator" content="自恋的爱">
  <script src="http://static.duoshuo.com/embed.js"></script>
  
  
  

  

</head>
<body>
<div class="container">
    <div class="mp-pusher" id="mp-pusher">
        <i id="scroll-up" class="fa fa-angle-up"></i>
        <nav id="mp-menu" class="mp-menu">
            <div class="mp-level">
                <a data-pjax class="back-home" style="font-size: 20px" href="/"><h2 ><i class="fa fa-home"></i>
                        Home</h2></a>
                <ul class="first-level">
                    <li>
                        <a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Archive</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-archive"></i>
                                Archive</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-archive" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/10/25/Java-JDBC-study/">Java_JDBC_study</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/10/20/Python-study-Day04/">Python-study-Day04</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/10/19/Python-study-Day03/">Python-study-Day03</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/10/18/Python-study-Day02/">Python-study-Day02</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/10/17/Python-study-Day01/">Python_study_Day01</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/10/16/Git-Study/">Git Study</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/03/15/EffectiveJAVA2/">EffectiveJAVA学习</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/01/08/如何做好公正/">公正</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2017/01/07/Git学习/">Git学习系列</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2016/12/10/hello-world/">Hello World</a>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Categories</a>

                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-copy"></i>
                                Categories</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-category" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Tags</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-tags"></i>
                                Tags</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-tag" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/java/">&nbsp;&nbsp;&nbsp;java</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/python/">&nbsp;&nbsp;&nbsp;python</a>
                                    <small>4</small>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    
                    <li class="mp-pjax"><a class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a></li>
                    <li><a class="fa fa-github" href="#">&nbsp;&nbsp;&nbsp;Github</a></li>

                </ul>

            </div>
        </nav>
        <div id="pjax">
            <div class="pjax-hidden" style="display: none">
                
                    <a  data-pjax href="/2017/10/25/Java-JDBC-study/">Java_JDBC_study</a>
                
                    <a  data-pjax href="/2017/10/20/Python-study-Day04/">Python-study-Day04</a>
                
                    <a  data-pjax href="/2017/10/19/Python-study-Day03/">Python-study-Day03</a>
                
                    <a  data-pjax href="/2017/10/18/Python-study-Day02/">Python-study-Day02</a>
                
                    <a  data-pjax href="/2017/10/17/Python-study-Day01/">Python_study_Day01</a>
                
                    <a  data-pjax href="/2017/10/16/Git-Study/">Git Study</a>
                
                    <a  data-pjax href="/2017/03/15/EffectiveJAVA2/">EffectiveJAVA学习</a>
                
                    <a  data-pjax href="/2017/01/08/如何做好公正/">公正</a>
                
                    <a  data-pjax href="/2017/01/07/Git学习/">Git学习系列</a>
                
                    <a  data-pjax href="/2016/12/10/hello-world/">Hello World</a>
                
                
                
                    <a data-pjax href="/tags/java/">&nbsp;&nbsp;java</a>
                
                    <a data-pjax href="/tags/python/">&nbsp;&nbsp;python</a>
                
                <a data-pjax class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a>
            </div>
            <nav class="nexus">
                <li  style="border-left: 1px solid #c6d0da;">
                    <a id="trigger" href="#"><i class="fa fa-bars"></i></a>
                </li>
                <li ><a id="nexus-back" data-pjax href="/">自恋的爱</a></li>
                
                <div id="nav-container">
                    <div class="post-navbar" style="line-height: 63px;display:none">
                        <li id="navbar-title"><a href="#">Python-study-Day04</a></li>
                        <li id="navbar-toc" style="border-left: none">
                            <a style="padding-right: 15px">
                                <span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
                            </a>
                            <div class="hidden-box">
                                <ul id="toc"></ul>
                            </div>
                        </li>
                    </div>
                </div>
                
            </nav>

            <div class="scroller">
            <div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->
  

<main class="content" role="main">
    <article class="post" >
    <span class="post-meta">
                  <div class="tag-tile">
                      
                      
                      <a data-pjax href='/tags/python/' style='color:#D5D5D5'>python</a>
                      
                      
                  </div>
                <h1 class="post-title" style="margin: 14px 0;color:#50585D">Python-study-Day04</h1>

                    <div class="post-meta">
                        Post on<span class="fa fa-clock-o"></span>
                        <time datetime="2017-10-20T02:01:44.000Z"
                              itemprop="datePublished">2017-10-20</time>
                    </div>
    </span>

        <section class="post-content">
            <h2 id="1-访问限制"><a href="#1-访问限制" class="headerlink" title="1.访问限制"></a>1.访问限制</h2><p>python中默认变量 <code>__xx</code> 和 <code>_xxx</code> 为私有成员，即外部不可以访问，但是python只是把 <code>__xxx</code>的变量名修改为 <code>_类名__xxx</code> ,所以任然可以通过此方法访问类内部数据(但是禁止这样的写法)，而 <code>_xxx</code> 外部可以直接访问，但是默认规则是内部私有成员，(建议通过公有的访问方法访问)</p>
<h2 id="2-继承和多态"><a href="#2-继承和多态" class="headerlink" title="2.继承和多态"></a>2.继承和多态</h2><pre><code>class Animal(object):
    def run(self):
        print(&apos;Animal is runing...&apos;)

class Dog(Animal):

    #覆盖父类run方法
    def run(self):
        print(&apos;Dog is runing...&apos;)

    #自定义子类方法
    def eat(self):
        print(&apos;Dog is eating...&apos;)

class Cat(Animal):
    def run(self):
        print (&apos;Cat is runing...&apos;)
</code></pre><p>Dog和Cat对象本身也属于Animal类型，(父类引用子类对象)</p>
<h2 id="获取对象信息"><a href="#获取对象信息" class="headerlink" title="获取对象信息"></a>获取对象信息</h2><p>type()函数获取对象类型</p>
<pre><code>&gt;&gt;&gt;type(123)
&lt;class &apos;int&apos;&gt;
&gt;&gt;&gt;type(None)
&lt;type(None) &apos;NoneType&apos;&gt;
</code></pre><p>isinstance()函数判断对象的类型</p>
<pre><code>&gt;&gt;&gt;a=Animal()
&gt;&gt;&gt;b=Dog()

&gt;&gt;&gt;isinstance(a,Animal)
True

#判断是否属于某类型的一种
&gt;&gt;&gt;isinstance([1,2,3],(list,tuple))
</code></pre><p>dir()获得一个对象的所有属性和方法</p>
<p>hasattr(obj,’x’) 判断obj对象是否有x属性</p>
<p>setattr(obj,’y’,99) 给obj对象的y属性赋值99</p>
<p>getattr(obj,’y’) 获取属性y</p>
<h2 id="实例属性和类属性"><a href="#实例属性和类属性" class="headerlink" title="实例属性和类属性"></a>实例属性和类属性</h2><h2 id="由于python是动态语言，所以可以将任何变量绑定到实例中，但是实例属性与类属性冲突-实例属性与类属性同名-时实例属性会覆盖类属性。"><a href="#由于python是动态语言，所以可以将任何变量绑定到实例中，但是实例属性与类属性冲突-实例属性与类属性同名-时实例属性会覆盖类属性。" class="headerlink" title="由于python是动态语言，所以可以将任何变量绑定到实例中，但是实例属性与类属性冲突(实例属性与类属性同名)时实例属性会覆盖类属性。"></a>由于python是动态语言，所以可以将任何变量绑定到实例中，但是实例属性与类属性冲突(实例属性与类属性同名)时实例属性会覆盖类属性。</h2><p>#面向对象高级编程</p>
<h2 id="使用-slots"><a href="#使用-slots" class="headerlink" title="使用__slots__"></a>使用<code>__slots__</code></h2><pre><code>class Student(object):
    pass

&gt;&gt;&gt;s=Student()
&gt;&gt;&gt;s.name=&apos;MIC&apos;  #给实例绑定属性name


def set_age(self,age):
    self.age=age

#给实例绑定方法
&gt;&gt;&gt;from types import MethodType
&gt;&gt;&gt;s.set_age=MethodType(set_age,s)

def set_score(self,score):
    self.score=score

#给class绑定方法，这样所有的实例类均可以调用
Student.set_score=set_score
</code></pre><p>使用<code>__slots__</code>来限制给实例绑定属性</p>
<pre><code>class Student():
    __slots__=(&apos;name&apos;,&apos;age&apos;)  #限制Student实例只可以绑定name，age属性
</code></pre><p>注意：<code>__slots__</code>定义的属性只对当前类实例有用，对继承的子类不起作用。只有当子类也定义了<code>__slots__</code>属性时，子类实例只能绑定子类和父类使用<code>__slots__</code>限制的属性</p>
<p>##@property装饰器<br>python内置的@property装饰器可以将方法变成属性调用</p>
<pre><code>class Student(object):

    @property
    def score(self):
        return self._score

    @score.setter
    def score(self,value):
        if not isinstance(value,int):
            raise ValueError(&apos;score must be an integer!&apos;)
        if vale &lt;0 or value&gt;100
            raise ValueError(&apos;score must between 0-100&apos;)
        self._score=value

&gt;&gt;&gt;s=Student()
&gt;&gt;&gt;s.score=60
&gt;&gt;&gt;s.score
60
</code></pre><h2 id="定制类"><a href="#定制类" class="headerlink" title="定制类"></a>定制类</h2><pre><code>class Student(object):
    def __init__(self,name):
        self.name=name

    def __str__(self):
        return &quot;Student object (name:%s)&quot; %self.name

    __repr__=__str__  #这样可以直接调用s,不用在print时，调用__str__函数

&gt;&gt;&gt; print(Student(&apos;Mic&apos;))
Student object (name:Mic)
</code></pre><p>一个类如果想像list或者tuple那样使用for循环调用，必须定义<code>__iter__</code>和<code>__next__</code>方法</p>
<p>如果想通过下标来获得类中元素，必须在类中定义<code>__getitem__</code>方法用以返回索引元素。</p>
<p>有时我们会访问类中不存在的属性，当无法找到时便会报错，我们可以通过<code>__getattr__</code><br>方法设置返回值：</p>
<pre><code>class Student(object):

    #可以返回属性和方法
    def __getattr__(self, attr):
        if attr==&apos;age&apos;:
            return lambda: 25
        else if attr==&quot;local&quot;
            return &quot;China&quot;
</code></pre><p>定义<code>__call__</code></p>
<pre><code>class Student(object):
    def __init__(self, name):
        self.name = name

    def __call__(self):
        print(&apos;My name is %s.&apos; % self.name)
</code></pre><h2 id="定义枚举类型"><a href="#定义枚举类型" class="headerlink" title="定义枚举类型"></a>定义枚举类型</h2><pre><code>from enum import Enum
Month=Enum(&apos;month&apos;,(&apos;Jan&apos;, &apos;Feb&apos;, &apos;Mar&apos;, &apos;Apr&apos;, &apos;May&apos;, &apos;Jun&apos;, &apos;Jul&apos;, &apos;Aug&apos;, &apos;Sep&apos;, &apos;Oct&apos;, &apos;Nov&apos;, &apos;Dec&apos;))

for name ,member in Month.__members__.items():
    print(name,&quot;=&gt;&quot;,member,&apos;,&apos;,member.value)  #value是自动赋值给成员的int常量，从1开始
</code></pre><p>也可以自定义枚举类</p>
<pre><code>from enum import Enum ,unique

@unique      #帮助检查确保没有重复的变量
class WeekDay(Enum):
    Sun = 0 # Sun的value被设定为0
    Mon = 1
    Tue = 2
    Wed = 3
    Thu = 4
    Fri = 5
    Sat = 6
</code></pre><h1 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h1><h2 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h2><pre><code>from multiprocessing import Process
import os

def run_proc(name):
    print(&quot;Run child process %s (%s)...&quot; %os.getpid())

if __name__==&apos;__main__&apos;:
    print(&apos;Parent process %s.&apos; %os.getpig())
    #创建进程实例，第一个传入进程执行函数，第二个参数是子进程的名字
    p=Process(target=run_proc,args=(&apos;test&apos;,))
    print(&apos;Child process will start.&apos;)
    p.start()    #启动子进程
    p.join()    #等待子进程结束后再继续往下运行，
    print(&apos;Child process end.&apos;)
</code></pre><p>启动大量子进程</p>
<pre><code>from multiprocessing import Pool
import os,time,random

def long_time_task(name):
    print(&apos;Run task %s (%s)...&apos; %（name,os.getpid()))
    start = time.time()
    time.sleep(random.random()*3)
    end=time.time()
    print(&apos;Task %s runs %0.2f seconds.&apos;%os.getpid())

if__name__=&apos;__main__&apos;:
    print(&apos;Parent process %s.&apos; %os.getpid())
    p=Pool(4)
    for i in range(5):
        p.apply_async(long_time_task,args(i,))
    print(&quot;Waiting for all subprocesses done...&quot;)
    #调用close方法之后不能添加新的进程
    p.close()
    #调用join()方法前会等待所有子进程执行完毕，调用join()之前必须调用close()
    p.join()    
    print(&quot;All subprocesses done.&quot;)
</code></pre><p>进程之间通信</p>
<pre><code>from multiprocessing import Process,Queue
import os,time,random

#写数据执行代码 
def write(q):
    print(&apos;Process to write:%s&apos;%os.getpid())
    for value in [&apos;A&apos;,&apos;B&apos;,&apos;C&apos;]:
        print(&apos;Put %s to queue...&apos;%value)
        q.put(value)
        time.sleep(random.random())
#读进程执行代码
def read(q):
    print(&apos;Process to read:%s&apos;%os.getpid())
    while True:
        value=q.get(True)
        print(&apos;Get %s from queue.&apos;%value)

if __name__==&apos;__main__&apos;:
    #父进程创建Queue，并传给各个子进程
    q=Queue()
    pw=Process(target=write,args=(q,))
    pr=Process(target=read,args=(q,))
    #启动子进程pw,写入：
    pw.start()
    #启动子进程pr，读取：
    pr.start()
    #等待pw结束：
    pw.join()
    #pr进程里是死循环，无法等待其结束，只能强制终止
    pr.terminate()
</code></pre><h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><pre><code>import time,threading

def loop():
    #current_thread()返回当前线程的实例
    print(&quot;thread %s is running...&quot; %threading.current_thread().name)
    n=0
    while n&lt;5:
        n=n+1
        print(&apos;thread %s&gt;&gt;&gt;%s&apos;%(threading.current_thread().name,n)
        time.sleep(1)
    print(&apos;thread %s ended.&apos;%threading.current_thread().name)

print(&apos;thread %s is running...&apos;%threading.current_thread().name)
#创建线程实例
t=threading.Thread(target=loop,name=&quot;LooThread&quot;)
t.start()
t.join()
print(&apos;thread %s ended.&apos;%threading.current_thread().name)
</code></pre><p>多线程与多进程最大的不同在于，多进程中，同一个变量各自有一份拷贝，而多线程中共享一个变量，任何一个线程修改，其他的线程内容也变了，可能会出现混乱。所以会出现lock()锁，保证数据安全性！</p>
<pre><code>import time,threading

#假定这是你的银行存款
balance = 0
#创建锁的实例
lock=threading.Lock()

def change_it(n):
    #先存后取，结果应该为0：
    global balance
    balance = balance + n
    balance = balance - n

def run_thread(n):
    for i in range(10000):
        #请求锁
        lock.acquire()
        #保证锁最终被释放
        try:
            change_it(n)
        finally:
            lock.release()

t1=threading.Thread(target=run_thread,args=(5,))
t2=threading.Thread(target=run_thread,args=(8,))
t1.start()
t2.start()
t1.join()
t2.join()
print(balance)
</code></pre><h2 id="分布式进程"><a href="#分布式进程" class="headerlink" title="分布式进程"></a>分布式进程</h2><pre><code>#task__master.py
import random,time,queue
from multiprocessing.managers import BaseManager

#发送任务的队列
task_queue=queue.Queue()
#接收结果的队列
result_queue=queue.Queue()

#从BaseManager继承的QueueManager
class QueueManager(BaseManager):
    pass

#将两个Queue都注册到网络上，callable参数关联了Queue对象：
QueueManager.register(&apos;get_task_queue&apos;,callable=lambda:task_queue)
QueueManager.register(&apos;get_result_queue&apos;,callable=lambda:result_queue)

#绑定端口5000，设置验证码为“abc”
manager = QueueManager(address=(&apos;&apos;,5000),authkey=b&apos;abc&apos;)

#启动Queue：
manager.start()

#获得通过网络访问的Queue对象
task = manager.get_task_queue()
result = manager.get_result_queue()

#放入任务
for i in range(10):
    n=random.randint(0,10000)
    print(&apos;Put task %d...&apos;%n)
    task.put(n)

#从result队列中读取结果：
print(&apos;Try get results...&apos;)
for i in range(10):
    r=result.get(timeout=10)
    print(&apos;Result:%s&apos;%r)
#关闭：
manager.shutdown()
print(&apos;master exit.&apos;)



#task_worker.py
import time,sys,queue
from multiprocessing.managers import BaseManager

#创建类似的QueueManager：
class QueueManager(BaseManager):
    pass

#由于这个QueueManager只从网络上获取Queue，所以注册时只提供名字
QueueManager.register(&apos;get_task_queue&apos;)
QueueManager.register(&apos;get_result_queue&apos;)

#连接到服务器，也就是运行task——master.py的机器
server_addr=&apos;127.0.0.1&apos;
print(&apos;Connect to server %s...&apos;%server_addr)

#注意端口号，验证码
m=QueueManager(address=(server_addr,5000),authkey=b&apos;abc&apos;)

#从网络连接
m.connect()

#获取Queue对象
task = m.get_task_queue()
result=m.get_result_queue()

#从task队列取任务，写入result队列
for i in range(10):
    try:
        n=task.get(timeout=1)
        print(&apos;run task %d * %d...&apos;%(n,n))
        r=&apos;%d*%d=%d&apos;%(n,n,n*n))
        time.sleep(1)
        result.put(r)
    except Queue.Empty:
        print(&apos;task queue is empty&apos;)

print(&apos;worker exit.&apos;)
</code></pre>
        </section>
        <hr/>
        <nav class="pagination" style="width:auto" role="pagination">
            
            <a data-pjax class="newer-posts" href="/2017/10/25/Java-JDBC-study/">← Prev Post</a>
            
            <a class="share-button" data-original-title title>Share this Post</a>
            
            <a data-pjax class="older-posts" href="/2017/10/19/Python-study-Day03/">Next Post →</a>
            
        </nav>
        <br/>
        <br/>
        <section id="comment">
            <div id="comment-box"></div>
        </section>


    </article>
</main>


  
<footer class="site-footer">
    
    <div class="inner">
        <section class="copyright"><a href="/"></a> &copy; 自恋的爱 2014</section>
        <section class="poweredby">Published with <a target="_blank" href="http://hexo.io/">Hexo   </a> and Theme by <a target="_blank" href="https://github.com/yuche/hexo-theme-kael">Kael</a></section>
    </div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
    <a id="close-button" href="#">X</a>
    <div class="block">
        <div class="loading">
            <span class="ball1"></span>
            <span class="ball2"></span>
        </div>
    </div>
</div>
  
<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
    if (!window.jQuery) {
        var script = document.createElement('script');
        script.src = "/js/jquery.min.js";
        document.body.appendChild(script);
    }
</script>
<script type="text/javascript" src="/js/lib.js"></script>
<script type="text/javascript" src="/js/main.js"></script>







</body>
</html>
